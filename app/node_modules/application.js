var loginWindow = require('logwindow');
var util = require('util');
var eventEmitter = require('events');

function application(config){
	eventEmitter.call(this);
	util.inherits(application,eventEmitter);
	this.config = config;
	this.windows = {};
	this.on('windowloaded'function(wObj,category){
		category = category ? category : 'GENERAL_CAT'
		this.windows[category] = wObj;
		wObj.on('close',function(w){
			var category = w.category ? w.category : 'GENERAL_CAT'
			delete this.windows[category]
		});
	})
}

application.prototype.openLogWindow = function(category){
	var win = new logWindow(this.config.logWindow,category);
	win.on('loaded'function(window){
		this.emit('windowloaded',window,category);
	});
}

application.prototype.closeLogWindow = function(category){
	category = category ? category : 'GENERAL_CAT'
	if(typeof this.windows[category] != 'undefined'){
		this.windows[category].close();
		this.emit('windowclosed',category);
		return true;
	}else{
		return false;
	}
}

application.prototype.addLogLine = function(message,category){
	category = category ? category : 'GENERAL_CAT'
	if(typeof this.windows[category] != 'undefined'){
		this.windows[category].fillLine(message);
	}
}
